"""
Clinical AI Explainability Expert Module
Convert ML predictions into understandable health guidance
Designed for rural populations with safety-first approach
"""

import numpy as np
from typing import Dict, List, Tuple, Any, Optional
import json
import random
from datetime import datetime

class ClinicalExplainer:
    """
    Convert ML predictions into clear, actionable health guidance
    Prioritizes safety and avoids medical jargon
    """
    
    def __init__(self):
        self.risk_thresholds = {
            'Green': {'min': 0.0, 'max': 0.4},
            'Yellow': {'min': 0.4, 'max': 0.7},
            'Red': {'min': 0.7, 'max': 1.0}
        }
        
        self.safety_disclaimers = self._load_safety_disclaimers()
        self.explanations = self._load_explanation_templates()
        self.recommendations = self._load_recommendation_templates()
        
    def _load_safety_disclaimers(self) -> Dict[str, Dict[str, str]]:
        """Load safety disclaimers in multiple languages"""
        
        return {
            'general': {
                'english': "This is not a medical diagnosis. Always consult a qualified doctor for proper medical advice.",
                'hindi': "यह चिकित्सा निदान नहीं है। उचित चिकित्सा सलाह के लिए हमेशा योग्य डॉक्टर से सलाह लें।",
                'marathi': "हे वैद्यकीय निदान नाही. योग्य वैद्यकीय सल्ल्यासाठी नेहमी पात्र डॉक्टरांचा सल्ला घ्या."
            },
            'emergency': {
                'english': "If you feel this is an emergency, call 108 or go to the nearest hospital immediately.",
                'hindi': "यदि आपको लगता है कि यह आपातकाल है, तो 108 पर कॉल करें या तुरंत निकटतम अस्पताल जाएं।",
                'marathi': "जर तुम्हाला वाटत असेल की ही आपत्कालीन परिस्थिती आहे, तर 108 वर कॉल करा किंवा ताबडतोब जवळच्या रुग्णालयात जा."
            },
            'pregnancy': {
                'english': "Pregnant women should always consult a doctor immediately for any health concerns.",
                'hindi': "गर्भवती महिलाओं को किसी भी स्वास्थ्य चिंता के लिए हमेशा तुरंत डॉक्टर से सलाह लेनी चाहिए।",
                'marathi': "गर्भवती महिलांनी कोणत्याही आरोग्य समस्येसाठी नेहमी ताबडतोब डॉक्टरांचा सल्ला घेतला पाहिजे."
            }
        }
    
    def _load_explanation_templates(self) -> Dict[str, Dict[str, Dict[str, str]]]:\n        \"\"\"Load explanation templates for different risk levels\"\"\"\n        \n        return {\n            'Green': {\n                'simple': {\n                    'english': \"Your symptoms suggest you may have a mild condition. Rest and basic care should help.\",\n                    'hindi': \"आपके लक्षण बताते हैं कि आपको हल्की समस्या हो सकती है। आराम और बुनियादी देखभाल से मदद मिलनी चाहिए।\",\n                    'marathi': \"तुमची लक्षणे सूचित करतात की तुम्हाला सौम्य समस्या असू शकते. विश्रांती आणि मूलभूत काळजी मदत करेल.\"\n                },\n                'detailed': {\n                    'english': \"Based on your symptoms, you likely have a minor health issue. Your body can probably handle this with rest, fluids, and basic care. Monitor your symptoms and seek help if they worsen.\",\n                    'hindi': \"आपके लक्षणों के आधार पर, आपको संभवतः एक छोटी स्वास्थ्य समस्या है। आपका शरीर शायद आराम, तरल पदार्थ और बुनियादी देखभाल से इसे संभाल सकता है। अपने लक्षणों पर नजर रखें और यदि वे बिगड़ते हैं तो मदद लें।\",\n                    'marathi': \"तुमच्या लक्षणांच्या आधारे, तुम्हाला कदाचित किरकोळ आरोग्य समस्या आहे. तुमचे शरीर कदाचित विश्रांती, द्रवपदार्थ आणि मूलभूत काळजीने हे हाताळू शकेल. तुमच्या लक्षणांवर लक्ष ठेवा आणि ती वाढल्यास मदत घ्या.\"\n                }\n            },\n            'Yellow': {\n                'simple': {\n                    'english': \"Your symptoms need attention. Please see a doctor or health worker soon.\",\n                    'hindi': \"आपके लक्षणों पर ध्यान देने की जरूरत है। कृपया जल्द ही डॉक्टर या स्वास्थ्य कार्यकर्ता से मिलें।\",\n                    'marathi': \"तुमच्या लक्षणांकडे लक्ष देण्याची गरज आहे. कृपया लवकरच डॉक्टर किंवा आरोग्य कार्यकर्त्याला भेटा.\"\n                },\n                'detailed': {\n                    'english': \"Your symptoms suggest a condition that needs medical attention. While not immediately dangerous, you should see a healthcare provider within 24 hours. Don't ignore these signs.\",\n                    'hindi': \"आपके लक्षण एक ऐसी स्थिति का सुझाव देते हैं जिसमें चिकित्सा ध्यान की आवश्यकता है। हालांकि तुरंत खतरनाक नहीं है, आपको 24 घंटे के भीतर एक स्वास्थ्य सेवा प्रदाता से मिलना चाहिए। इन संकेतों को नजरअंदाज न करें।\",\n                    'marathi': \"तुमची लक्षणे अशी स्थिती सूचित करतात ज्यासाठी वैद्यकीय लक्ष आवश्यक आहे. तात्काळ धोकादायक नसले तरी, तुम्ही 24 तासांच्या आत आरोग्य सेवा प्रदात्याला भेटले पाहिजे. या चिन्हांकडे दुर्लक्ष करू नका.\"\n                }\n            },\n            'Red': {\n                'simple': {\n                    'english': \"Your symptoms are serious. Go to a hospital or call 108 right now.\",\n                    'hindi': \"आपके लक्षण गंभीर हैं। अभी अस्पताल जाएं या 108 पर कॉल करें।\",\n                    'marathi': \"तुमची लक्षणे गंभीर आहेत. आत्ताच रुग्णालयात जा किंवा 108 वर कॉल करा.\"\n                },\n                'detailed': {\n                    'english': \"Your symptoms indicate a potentially serious condition that requires immediate medical attention. Do not delay - go to the nearest hospital or emergency center right away. If transportation is difficult, call 108 for an ambulance.\",\n                    'hindi': \"आपके लक्षण एक संभावित गंभीर स्थिति का संकेत देते हैं जिसके लिए तत्काल चिकित्सा ध्यान की आवश्यकता है। देरी न करें - तुरंत निकटतम अस्पताल या आपातकालीन केंद्र जाएं। यदि परिवहन कठिन है, तो एम्बुलेंस के लिए 108 पर कॉल करें।\",\n                    'marathi': \"तुमची लक्षणे संभाव्य गंभीर स्थितीचे संकेत देतात ज्यासाठी तात्काळ वैद्यकीय लक्ष आवश्यक आहे. विलंब करू नका - ताबडतोब जवळच्या रुग्णालयात किंवा आपत्कालीन केंद्रात जा. जर वाहतूक कठीण असेल तर रुग्णवाहिकेसाठी 108 वर कॉल करा.\"\n                }\n            }\n        }\n    \n    def _load_recommendation_templates(self) -> Dict[str, Dict[str, List[str]]]:\n        \"\"\"Load recommendation templates for different risk levels\"\"\"\n        \n        return {\n            'Green': {\n                'english': [\n                    \"Rest and get plenty of sleep\",\n                    \"Drink lots of clean water\",\n                    \"Eat light, nutritious food\",\n                    \"Avoid heavy work for now\",\n                    \"Watch your symptoms - if they get worse, seek help\",\n                    \"Take paracetamol for fever if needed\"\n                ],\n                'hindi': [\n                    \"आराम करें और भरपूर नींद लें\",\n                    \"बहुत सारा साफ पानी पिएं\",\n                    \"हल्का, पौष्टिक भोजन करें\",\n                    \"अभी भारी काम से बचें\",\n                    \"अपने लक्षणों पर नजर रखें - यदि वे बिगड़ते हैं तो मदद लें\",\n                    \"जरूरत पड़ने पर बुखार के लिए पैरासिटामोल लें\"\n                ],\n                'marathi': [\n                    \"विश्रांती घ्या आणि भरपूर झोप घ्या\",\n                    \"भरपूर स्वच्छ पाणी प्या\",\n                    \"हलके, पौष्टिक अन्न घ्या\",\n                    \"आत्ता जड काम टाळा\",\n                    \"तुमच्या लक्षणांवर लक्ष ठेवा - जर ती वाढली तर मदत घ्या\",\n                    \"गरज पडल्यास तापासाठी पॅरासिटामॉल घ्या\"\n                ]\n            },\n            'Yellow': {\n                'english': [\n                    \"See a doctor or ASHA worker within 24 hours\",\n                    \"Don't ignore these symptoms\",\n                    \"Rest and avoid strenuous activities\",\n                    \"Keep drinking fluids\",\n                    \"Monitor temperature regularly\",\n                    \"Avoid contact with others if you have fever\",\n                    \"Take prescribed medicines only\"\n                ],\n                'hindi': [\n                    \"24 घंटे के भीतर डॉक्टर या आशा कार्यकर्ता से मिलें\",\n                    \"इन लक्षणों को नजरअंदाज न करें\",\n                    \"आराम करें और कठिन गतिविधियों से बचें\",\n                    \"तरल पदार्थ पीते रहें\",\n                    \"नियमित रूप से तापमान की जांच करें\",\n                    \"यदि आपको बुखार है तो दूसरों से संपर्क से बचें\",\n                    \"केवल निर्धारित दवाइयां लें\"\n                ],\n                'marathi': [\n                    \"24 तासांच्या आत डॉक्टर किंवा आशा कार्यकर्त्याला भेटा\",\n                    \"या लक्षणांकडे दुर्लक्ष करू नका\",\n                    \"विश्रांती घ्या आणि कठोर क्रियाकलाप टाळा\",\n                    \"द्रवपदार्थ पित राहा\",\n                    \"नियमितपणे तापमान तपासा\",\n                    \"जर तुम्हाला ताप असेल तर इतरांशी संपर्क टाळा\",\n                    \"फक्त विहित औषधे घ्या\"\n                ]\n            },\n            'Red': {\n                'english': [\n                    \"Go to hospital immediately - don't wait\",\n                    \"Call 108 if you need an ambulance\",\n                    \"Bring someone with you for support\",\n                    \"Don't eat or drink anything until you see a doctor\",\n                    \"If breathing is difficult, sit upright\",\n                    \"Stay calm and get help fast\"\n                ],\n                'hindi': [\n                    \"तुरंत अस्पताल जाएं - इंतजार न करें\",\n                    \"यदि आपको एम्बुलेंस की जरूरत है तो 108 पर कॉल करें\",\n                    \"सहारे के लिए किसी को अपने साथ लाएं\",\n                    \"डॉक्टर को दिखाने तक कुछ न खाएं या पिएं\",\n                    \"यदि सांस लेने में कठिनाई है तो सीधे बैठें\",\n                    \"शांत रहें और जल्दी मदद लें\"\n                ],\n                'marathi': [\n                    \"ताबडतोब रुग्णालयात जा - वाट पाहू नकोस\",\n                    \"जर तुम्हाला रुग्णवाहिकेची गरज असेल तर 108 वर कॉल करा\",\n                    \"आधारासाठी कोणाला तरी सोबत आणा\",\n                    \"डॉक्टरांना दाखवेपर्यंत काहीही खाऊ किंवा पिऊ नका\",\n                    \"जर श्वास घेण्यात अडचण येत असेल तर सरळ बसा\",\n                    \"शांत राहा आणि लवकर मदत घ्या\"\n                ]\n            }\n        }\n    \n    def convert_ml_prediction_to_risk(self, prediction_proba: np.ndarray, \n                                    model_type: str = 'risk') -> Dict[str, Any]:\n        \"\"\"Convert ML prediction probabilities to risk levels\"\"\"\n        \n        if model_type == 'risk':\n            # Direct risk prediction\n            risk_classes = ['Green', 'Red', 'Yellow']  # Based on label encoding\n            predicted_class = np.argmax(prediction_proba)\n            confidence = np.max(prediction_proba)\n            risk_level = risk_classes[predicted_class]\n        else:\n            # Disease prediction - convert to risk\n            risk_level, confidence = self._disease_to_risk_mapping(prediction_proba)\n        \n        # Apply safety rules\n        risk_level = self._apply_safety_rules(risk_level, confidence)\n        \n        return {\n            'risk_level': risk_level,\n            'confidence': float(confidence),\n            'probabilities': {cls: float(prob) for cls, prob in zip(['Green', 'Red', 'Yellow'], prediction_proba)}\n        }\n    \n    def _disease_to_risk_mapping(self, disease_proba: np.ndarray) -> Tuple[str, float]:\n        \"\"\"Map disease predictions to risk levels\"\"\"\n        \n        # Disease categories and their risk mappings\n        disease_risk_map = {\n            'respiratory': 'Yellow',\n            'cardiovascular': 'Red',\n            'infectious': 'Yellow',\n            'gastrointestinal': 'Green',\n            'maternal': 'Yellow',\n            'diabetes_related': 'Yellow',\n            'hypertension': 'Red',\n            'malaria': 'Red',\n            'dengue': 'Red',\n            'tuberculosis': 'Red'\n        }\n        \n        disease_categories = list(disease_risk_map.keys())\n        predicted_disease_idx = np.argmax(disease_proba)\n        confidence = np.max(disease_proba)\n        \n        if predicted_disease_idx < len(disease_categories):\n            predicted_disease = disease_categories[predicted_disease_idx]\n            risk_level = disease_risk_map[predicted_disease]\n        else:\n            risk_level = 'Yellow'  # Default to caution\n        \n        return risk_level, confidence\n    \n    def _apply_safety_rules(self, risk_level: str, confidence: float) -> str:\n        \"\"\"Apply safety rules to ensure conservative risk assessment\"\"\"\n        \n        # Safety rule 1: Low confidence should increase risk level\n        if confidence < 0.6:\n            if risk_level == 'Green':\n                risk_level = 'Yellow'\n        \n        # Safety rule 2: Never downgrade from Red\n        # (This is already handled by not allowing Red -> lower transitions)\n        \n        # Safety rule 3: Multiple symptoms should increase caution\n        # (This would be handled at the input level)\n        \n        return risk_level\n    \n    def generate_explanation(self, risk_level: str, confidence: float, \n                           symptoms: List[str], patient_info: Dict[str, Any],\n                           language: str = 'english', \n                           detail_level: str = 'simple') -> Dict[str, Any]:\n        \"\"\"Generate comprehensive explanation for the prediction\"\"\"\n        \n        # Get base explanation\n        explanation_text = self.explanations[risk_level][detail_level][language]\n        \n        # Get recommendations\n        recommendations = self.recommendations[risk_level][language]\n        \n        # Add symptom-specific context\n        symptom_context = self._generate_symptom_context(symptoms, language)\n        \n        # Add demographic considerations\n        demographic_notes = self._generate_demographic_notes(patient_info, language)\n        \n        # Select appropriate disclaimers\n        disclaimers = self._select_disclaimers(risk_level, patient_info, language)\n        \n        # Generate confidence explanation\n        confidence_explanation = self._explain_confidence(confidence, language)\n        \n        return {\n            'risk_level': risk_level,\n            'main_explanation': explanation_text,\n            'confidence_score': confidence,\n            'confidence_explanation': confidence_explanation,\n            'symptom_context': symptom_context,\n            'recommendations': recommendations,\n            'demographic_notes': demographic_notes,\n            'disclaimers': disclaimers,\n            'language': language,\n            'timestamp': datetime.now().isoformat()\n        }\n    \n    def _generate_symptom_context(self, symptoms: List[str], language: str) -> str:\n        \"\"\"Generate context based on specific symptoms\"\"\"\n        \n        if not symptoms:\n            return \"\"\n        \n        symptom_contexts = {\n            'english': {\n                'fever': \"Fever can be a sign of infection. Monitor your temperature.\",\n                'cough': \"Persistent cough should be evaluated, especially if lasting more than a week.\",\n                'breathlessness': \"Difficulty breathing is a serious symptom that needs immediate attention.\",\n                'chest_pain': \"Chest pain should always be taken seriously.\"\n            },\n            'hindi': {\n                'fever': \"बुखार संक्रमण का संकेत हो सकता है। अपने तापमान पर नजर रखें।\",\n                'cough': \"लगातार खांसी का मूल्यांकन किया जाना चाहिए, खासकर यदि यह एक सप्ताह से अधिक समय तक रहे।\",\n                'breathlessness': \"सांस लेने में कठिनाई एक गंभीर लक्षण है जिस पर तत्काल ध्यान देने की आवश्यकता है।\",\n                'chest_pain': \"छाती के दर्द को हमेशा गंभीरता से लेना चाहिए।\"\n            },\n            'marathi': {\n                'fever': \"ताप हा संसर्गाचा संकेत असू शकतो. तुमच्या तापमानावर लक्ष ठेवा.\",\n                'cough': \"सततच्या खोकल्याचे मूल्यांकन केले पाहिजे, विशेषत: जर तो एक आठवड्यापेक्षा जास्त काळ राहिला.\",\n                'breathlessness': \"श्वास घेण्यात अडचण हे एक गंभीर लक्षण आहे ज्यावर तात्काळ लक्ष देण्याची गरज आहे.\",\n                'chest_pain': \"छातीतील वेदना नेहमी गांभीर्याने घेतली पाहिजे.\"\n            }\n        }\n        \n        contexts = []\n        for symptom in symptoms[:3]:  # Limit to top 3 symptoms\n            symptom_key = symptom.lower().replace(' ', '_')\n            if symptom_key in symptom_contexts[language]:\n                contexts.append(symptom_contexts[language][symptom_key])\n        \n        return \" \".join(contexts)\n    \n    def _generate_demographic_notes(self, patient_info: Dict[str, Any], language: str) -> List[str]:\n        \"\"\"Generate notes based on patient demographics\"\"\"\n        \n        notes = []\n        \n        # Age-based notes\n        age = patient_info.get('age', 0)\n        if age >= 65:\n            age_notes = {\n                'english': \"Older adults should be extra careful with any health symptoms.\",\n                'hindi': \"बुजुर्गों को किसी भी स्वास्थ्य लक्षण के साथ अतिरिक्त सावधान रहना चाहिए।\",\n                'marathi': \"वृद्ध व्यक्तींनी कोणत्याही आरोग्य लक्षणांबाबत अतिरिक्त सावधगिरी बाळगली पाहिजे.\"\n            }\n            notes.append(age_notes[language])\n        elif age < 5:\n            child_notes = {\n                'english': \"Children can become seriously ill quickly. Watch symptoms closely.\",\n                'hindi': \"बच्चे जल्दी गंभीर रूप से बीमार हो सकते हैं। लक्षणों पर बारीकी से नजर रखें।\",\n                'marathi': \"मुले लवकर गंभीर आजारी होऊ शकतात. लक्षणांवर बारकाईने लक्ष ठेवा.\"\n            }\n            notes.append(child_notes[language])\n        \n        # Pregnancy notes\n        if patient_info.get('is_pregnant', False):\n            pregnancy_notes = {\n                'english': \"Pregnancy requires special medical attention for any symptoms.\",\n                'hindi': \"गर्भावस्था में किसी भी लक्षण के लिए विशेष चिकित्सा ध्यान की आवश्यकता होती है।\",\n                'marathi': \"गर्भावस्थेत कोणत्याही लक्षणांसाठी विशेष वैद्यकीय लक्ष आवश्यक असते.\"\n            }\n            notes.append(pregnancy_notes[language])\n        \n        # Diabetes notes\n        if patient_info.get('has_diabetes', False):\n            diabetes_notes = {\n                'english': \"People with diabetes should monitor symptoms more carefully.\",\n                'hindi': \"मधुमेह वाले लोगों को लक्षणों की अधिक सावधानी से निगरानी करनी चाहिए।\",\n                'marathi': \"मधुमेह असलेल्या लोकांनी लक्षणांचे अधिक काळजीपूर्वक निरीक्षण केले पाहिजे.\"\n            }\n            notes.append(diabetes_notes[language])\n        \n        return notes\n    \n    def _select_disclaimers(self, risk_level: str, patient_info: Dict[str, Any], \n                          language: str) -> List[str]:\n        \"\"\"Select appropriate disclaimers based on context\"\"\"\n        \n        disclaimers = [self.safety_disclaimers['general'][language]]\n        \n        if risk_level == 'Red':\n            disclaimers.append(self.safety_disclaimers['emergency'][language])\n        \n        if patient_info.get('is_pregnant', False):\n            disclaimers.append(self.safety_disclaimers['pregnancy'][language])\n        \n        return disclaimers\n    \n    def _explain_confidence(self, confidence: float, language: str) -> str:\n        \"\"\"Explain what the confidence score means\"\"\"\n        \n        confidence_explanations = {\n            'english': {\n                'high': f\"The system is {confidence:.0%} confident in this assessment.\",\n                'medium': f\"The system is {confidence:.0%} confident. Consider getting a second opinion.\",\n                'low': f\"The system is only {confidence:.0%} confident. Please see a healthcare provider.\"\n            },\n            'hindi': {\n                'high': f\"सिस्टम इस मूल्यांकन में {confidence:.0%} आश्वस्त है।\",\n                'medium': f\"सिस्टम {confidence:.0%} आश्वस्त है। दूसरी राय लेने पर विचार करें।\",\n                'low': f\"सिस्टम केवल {confidence:.0%} आश्वस्त है। कृपया स्वास्थ्य सेवा प्रदाता से मिलें।\"\n            },\n            'marathi': {\n                'high': f\"सिस्टम या मूल्यांकनात {confidence:.0%} खात्री बाळगते.\",\n                'medium': f\"सिस्टम {confidence:.0%} खात्री बाळगते. दुसरे मत घेण्याचा विचार करा.\",\n                'low': f\"सिस्टम फक्त {confidence:.0%} खात्री बाळगते. कृपया आरोग्य सेवा प्रदात्याला भेटा.\"\n            }\n        }\n        \n        if confidence >= 0.8:\n            level = 'high'\n        elif confidence >= 0.6:\n            level = 'medium'\n        else:\n            level = 'low'\n        \n        return confidence_explanations[language][level]\n    \n    def create_patient_report(self, prediction_result: Dict[str, Any], \n                            patient_info: Dict[str, Any],\n                            language: str = 'english') -> Dict[str, Any]:\n        \"\"\"Create a comprehensive patient report\"\"\"\n        \n        risk_level = prediction_result['risk_level']\n        confidence = prediction_result['confidence']\n        symptoms = prediction_result.get('symptoms', [])\n        \n        # Generate explanation\n        explanation = self.generate_explanation(\n            risk_level, confidence, symptoms, patient_info, language, 'detailed'\n        )\n        \n        # Create structured report\n        report = {\n            'patient_id': patient_info.get('patient_id', 'unknown'),\n            'assessment_date': datetime.now().isoformat(),\n            'risk_assessment': {\n                'level': risk_level,\n                'confidence': confidence,\n                'color_code': self._get_color_code(risk_level)\n            },\n            'symptoms_reported': symptoms,\n            'explanation': explanation,\n            'next_steps': self._get_next_steps(risk_level, language),\n            'follow_up_timeline': self._get_follow_up_timeline(risk_level, language),\n            'emergency_contacts': self._get_emergency_contacts(language),\n            'language': language\n        }\n        \n        return report\n    \n    def _get_color_code(self, risk_level: str) -> str:\n        \"\"\"Get color code for UI display\"\"\"\n        color_map = {\n            'Green': '#4CAF50',\n            'Yellow': '#FF9800', \n            'Red': '#F44336'\n        }\n        return color_map.get(risk_level, '#9E9E9E')\n    \n    def _get_next_steps(self, risk_level: str, language: str) -> List[str]:\n        \"\"\"Get immediate next steps based on risk level\"\"\"\n        \n        next_steps = {\n            'Green': {\n                'english': [\n                    \"Continue monitoring symptoms\",\n                    \"Rest and maintain good hygiene\",\n                    \"Seek help if symptoms worsen\"\n                ],\n                'hindi': [\n                    \"लक्षणों की निगरानी जारी रखें\",\n                    \"आराम करें और अच्छी स्वच्छता बनाए रखें\",\n                    \"यदि लक्षण बिगड़ते हैं तो मदद लें\"\n                ],\n                'marathi': [\n                    \"लक्षणांचे निरीक्षण चालू ठेवा\",\n                    \"विश्रांती घ्या आणि चांगली स्वच्छता राखा\",\n                    \"जर लक्षणे वाढली तर मदत घ्या\"\n                ]\n            },\n            'Yellow': {\n                'english': [\n                    \"Schedule appointment with healthcare provider\",\n                    \"Monitor symptoms closely\",\n                    \"Avoid contact with others if infectious\"\n                ],\n                'hindi': [\n                    \"स्वास्थ्य सेवा प्रदाता के साथ अपॉइंटमेंट शेड्यूल करें\",\n                    \"लक्षणों की बारीकी से निगरानी करें\",\n                    \"यदि संक्रामक है तो दूसरों से संपर्क से बचें\"\n                ],\n                'marathi': [\n                    \"आरोग्य सेवा प्रदात्यासोबत भेटीची वेळ ठरवा\",\n                    \"लक्षणांचे बारकाईने निरीक्षण करा\",\n                    \"जर संसर्गजन्य असेल तर इतरांशी संपर्क टाळा\"\n                ]\n            },\n            'Red': {\n                'english': [\n                    \"Go to emergency room immediately\",\n                    \"Call 108 for ambulance if needed\",\n                    \"Do not delay medical attention\"\n                ],\n                'hindi': [\n                    \"तुरंत आपातकालीन कक्ष में जाएं\",\n                    \"जरूरत पड़ने पर एम्बुलेंस के लिए 108 पर कॉल करें\",\n                    \"चिकित्सा ध्यान में देरी न करें\"\n                ],\n                'marathi': [\n                    \"ताबडतोब आपत्कालीन कक्षात जा\",\n                    \"गरज पडल्यास रुग्णवाहिकेसाठी 108 वर कॉल करा\",\n                    \"वैद्यकीय लक्षात विलंब करू नका\"\n                ]\n            }\n        }\n        \n        return next_steps[risk_level][language]\n    \n    def _get_follow_up_timeline(self, risk_level: str, language: str) -> str:\n        \"\"\"Get follow-up timeline based on risk level\"\"\"\n        \n        timelines = {\n            'Green': {\n                'english': \"Monitor for 2-3 days. Seek help if symptoms persist or worsen.\",\n                'hindi': \"2-3 दिनों तक निगरानी करें। यदि लक्षण बने रहते हैं या बिगड़ते हैं तो मदद लें।\",\n                'marathi': \"2-3 दिवस निरीक्षण करा. जर लक्षणे कायम राहिली किंवा वाढली तर मदत घ्या.\"\n            },\n            'Yellow': {\n                'english': \"See healthcare provider within 24 hours. Monitor closely.\",\n                'hindi': \"24 घंटे के भीतर स्वास्थ्य सेवा प्रदाता से मिलें। बारीकी से निगरानी करें।\",\n                'marathi': \"24 तासांच्या आत आरोग्य सेवा प्रदात्याला भेटा. बारकाईने निरीक्षण करा.\"\n            },\n            'Red': {\n                'english': \"Seek immediate medical attention. Do not wait.\",\n                'hindi': \"तत्काल चिकित्सा सहायता लें। प्रतीक्षा न करें।\",\n                'marathi': \"तात्काळ वैद्यकीय मदत घ्या. वाट पाहू नका.\"\n            }\n        }\n        \n        return timelines[risk_level][language]\n    \n    def _get_emergency_contacts(self, language: str) -> Dict[str, str]:\n        \"\"\"Get emergency contact information\"\"\"\n        \n        contacts = {\n            'english': {\n                'ambulance': \"108 - National Ambulance Service\",\n                'health_helpline': \"104 - National Health Helpline\",\n                'local_phc': \"Contact your nearest Primary Health Center\"\n            },\n            'hindi': {\n                'ambulance': \"108 - राष्ट्रीय एम्बुलेंस सेवा\",\n                'health_helpline': \"104 - राष्ट्रीय स्वास्थ्य हेल्पलाइन\",\n                'local_phc': \"अपने निकटतम प्राथमिक स्वास्थ्य केंद्र से संपर्क करें\"\n            },\n            'marathi': {\n                'ambulance': \"108 - राष्ट्रीय रुग्णवाहिका सेवा\",\n                'health_helpline': \"104 - राष्ट्रीय आरोग्य हेल्पलाइन\",\n                'local_phc': \"तुमच्या जवळच्या प्राथमिक आरोग्य केंद्राशी संपर्क साधा\"\n            }\n        }\n        \n        return contacts[language]\n\nif __name__ == \"__main__\":\n    # Demo usage\n    explainer = ClinicalExplainer()\n    \n    # Sample prediction\n    prediction_proba = np.array([0.1, 0.8, 0.1])  # High Red risk\n    prediction_result = explainer.convert_ml_prediction_to_risk(prediction_proba)\n    \n    # Sample patient info\n    patient_info = {\n        'patient_id': 'P_000001',\n        'age': 45,\n        'gender': 'F',\n        'is_pregnant': False,\n        'has_diabetes': True,\n        'has_hypertension': False\n    }\n    \n    # Generate explanation\n    symptoms = ['बुखार', 'सांस लेने में तकलीफ', 'छाती में दर्द']\n    explanation = explainer.generate_explanation(\n        prediction_result['risk_level'],\n        prediction_result['confidence'],\n        symptoms,\n        patient_info,\n        language='hindi',\n        detail_level='detailed'\n    )\n    \n    print(\"AI-Sanjivani Clinical Explanation Demo\")\n    print(\"=\" * 50)\n    print(f\"Risk Level: {explanation['risk_level']}\")\n    print(f\"Confidence: {explanation['confidence_score']:.1%}\")\n    print(f\"\\nExplanation: {explanation['main_explanation']}\")\n    print(f\"\\nRecommendations:\")\n    for i, rec in enumerate(explanation['recommendations'][:3], 1):\n        print(f\"{i}. {rec}\")\n    print(f\"\\nDisclaimers:\")\n    for disclaimer in explanation['disclaimers']:\n        print(f\"⚠️ {disclaimer}\")\n    \n    # Create full patient report\n    prediction_result['symptoms'] = symptoms\n    report = explainer.create_patient_report(prediction_result, patient_info, 'hindi')\n    \n    print(f\"\\nFull report generated for patient: {report['patient_id']}\")\n    print(f\"Assessment date: {report['assessment_date']}\")